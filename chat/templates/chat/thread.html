{% extends "base.html" %}

{% block title %}
    {{ page_title }}
{% endblock title %}

{% block content %}
<div class="main-container thread-container">

    {# FIX FOR 2-SECOND REFRESH ISSUE: Set to 300 seconds (5 minutes) #}
    <meta http-equiv="refresh" content="300"> 

    <a href="{% url 'inbox' %}" class="btn btn-secondary btn-sm chat-back-link">&leftarrow; Back to Inbox</a>

    <h2 class="section-title thread-title">Conversation with {{ other_user.username }}</h2>

    <div class="chat-window">
        {% if messages %}
            {% for message in messages %}
                {% if message.sender == request.user %}
                    {% comment %} Message sent by the current user (Align Right) {% endcomment %}
                    <div class="message-row message-sent">
                        <div class="message-bubble">{{ message.content }}</div>
                        <span class="message-timestamp">{{ message.timestamp|date:"g:i A" }}</span>
                    </div>
                {% else %}
                    {% comment %} Message sent by the other user (Align Left) {% endcomment %}
                    <div class="message-row message-received">
                        <div class="message-bubble">{{ message.content }}</div>
                        <span class="message-timestamp">{{ message.timestamp|date:"g:i A" }}</span>
                    </div>
                {% endif %}
            {% endfor %}
        {% else %}
            <p class="no-posts-message">Start your conversation!</p>
        {% endif %}
    </div>

    <div class="message-form-wrapper">
        <form method="POST" action="{% url 'thread' thread.id %}">
            {% csrf_token %}
            {{ form.content }}
            <button type="submit" class="btn btn-primary message-send-btn">Send</button>
        </form>
    </div>
</div>
{% endblock content %}